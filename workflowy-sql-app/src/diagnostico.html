<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico QueryVault</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .error { background: #ffe6e6; border: 1px solid #ff9999; }
        .success { background: #e6ffe6; border: 1px solid #99ff99; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>üîß Diagn√≥stico QueryVault</h1>
    
    <div id="status" class="debug">
        <h3>Estado inicial</h3>
        <p>Iniciando diagn√≥stico...</p>
    </div>
    
    <div id="health" class="debug">
        <h3>Health Check</h3>
        <p>Verificando conexi√≥n...</p>
    </div>
    
    <div id="data" class="debug">
        <h3>Datos del servidor</h3>
        <p>Cargando consultas...</p>
    </div>
    
    <div id="frontend" class="debug">
        <h3>Estado del frontend</h3>
        <p>Verificando variables...</p>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3000/api';
        
        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const className = type === 'error' ? 'debug error' : 
                             type === 'success' ? 'debug success' : 'debug';
            element.className = className;
            element.innerHTML = `<h3>${element.querySelector('h3').textContent}</h3><pre>${message}</pre>`;
        }
        
        async function runDiagnostic() {
            try {
                // 1. Health check
                log('health', 'üîç Probando health check...');
                const healthResponse = await fetch(`${API_BASE_URL}/health`);
                const healthData = await healthResponse.json();
                log('health', `‚úÖ Health check OK\n${JSON.stringify(healthData, null, 2)}`, 'success');
                
                // 2. Get data
                log('data', 'üì° Obteniendo consultas del servidor...');
                const dataResponse = await fetch(`${API_BASE_URL}/consultas`);
                const consultas = await dataResponse.json();
                log('data', `üìã Consultas recibidas: ${consultas.length}\n${JSON.stringify(consultas, null, 2)}`, 'success');
                
                // 3. Frontend state
                log('frontend', `üìä Estado del frontend:
queries array: ${Array.isArray(consultas) ? 'Es array' : 'NO es array'}
queries length: ${consultas.length}
queries content: ${JSON.stringify(consultas, null, 2)}

DOM Elements:
- queriesList: ${document.getElementById('queries-list') ? 'Existe' : 'NO existe'}
- emptyState: ${document.getElementById('empty-state') ? 'Existe' : 'NO existe'}
- searchInput: ${document.getElementById('search-input') ? 'Existe' : 'NO existe'}`, 'success');
                
                log('status', '‚úÖ Diagn√≥stico completado exitosamente', 'success');
                
            } catch (error) {
                log('status', `‚ùå Error en diagn√≥stico: ${error.message}\n${error.stack}`, 'error');
            }
        }
        
        // Ejecutar diagn√≥stico al cargar
        window.addEventListener('load', runDiagnostic);
    </script>
</body>
</html>